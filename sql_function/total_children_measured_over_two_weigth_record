CREATE OR REPLACE FUNCTION core.total_children_measured_over_two_weigth_record(conditions varchar,startDate varchar,endDate varchar) 
RETURNS int
AS $$    
    DECLARE totalCount int:=0; 
    dateBetweenCondition varchar := '';
    BEGIN      
    if (startDate != '' AND endDate != '') THEN            
		dateBetweenCondition := dateBetweenCondition || E' and( cg.event_date between \''|| startDate || E'\' and \''
                             || endDate || E'\')';
	END IF;
    
    	DROP TABLE IF EXISTS over_two_weigth_record_temp;
         CREATE TEMP TABLE IF NOT EXISTS over_two_weigth_record_temp (
            total int NOT NULL DEFAULT 0 
            
        );
        
      EXECUTE 'insert into over_two_weigth_record_temp(total) 
		select count(*)
        FROM core."viewJsonDataConversionOfClient" c
        join core.child_growth  cg
        on c.base_entity_id = cg.base_entity_id	
        WHERE c.event_type =' || E' \'Birth Registration\'' || conditions || dateBetweenCondition || 'group by cg.base_entity_id having count(cg.base_entity_id)>=2 order by cg.base_entity_id';
	
    return (select count(*) from over_two_weigth_record_temp);
  END;
  $$ LANGUAGE 'plpgsql';
  
  
    SELECT core.total_children_measured_over_two_weigth_record('','2018-02-07','2018-08-15'); 
